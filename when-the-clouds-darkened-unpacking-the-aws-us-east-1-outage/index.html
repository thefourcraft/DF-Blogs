<!DOCTYPE html><html lang="en-us"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><title>When the Clouds Darkened - Unpacking the AWS US-East-1 Outage</title><meta name="description" content="AWS, one of the world's most extensive cloud service providers, faced a substantial outage in its US-East-1 region on December 7, 2021"><meta name="generator" content="Publii Open-Source CMS for Static Site"><script>window.publiiEmbedConsentCheck = function (cookieGroup) {
                var configName = 'publii-gdpr-allowed-cookies-v1';
                var lastConfigSave = localStorage.getItem('publii-gdpr-cookies-config-save-date');
                var configIsFresh = false;

                if (lastConfigSave !== null) {
                    lastConfigSave = parseInt(lastConfigSave, 10);

                    if (lastConfigSave === 0) {
                        configIsFresh = true;
                    } else if (30 > 0 && +new Date() - lastConfigSave < 30 * 24 * 60 * 60 * 1000) {
                        configIsFresh = true;
                    }
                }

                if (!configIsFresh) {
                    return;
                }

                var config = localStorage.getItem(configName);

                if (config && config.indexOf(cookieGroup) > -1) {
                    var iframesToUnlock = document.querySelectorAll('.pec-wrapper[data-consent-group-id="' + cookieGroup + '"]');

                    for (var i = 0; i < iframesToUnlock.length; i++) {
                        var iframeWrapper = iframesToUnlock[i];

                        if (iframeWrapper.getAttribute('data-consent-given') === 'true') {
                            continue;
                        }

                        iframeWrapper.setAttribute('data-consent-given', 'true');
                        iframeWrapper.querySelector('.pec-overlay').classList.remove('is-active');
                        iframeWrapper.querySelector('.pec-overlay').setAttribute('aria-hidden', 'true');
                        var iframe = iframeWrapper.querySelector('iframe');
                        iframe.setAttribute('src', iframe.getAttribute('data-consent-src'));
                    }
                }
            }</script><link rel="canonical" href="https://blog.thefourcraft.com/when-the-clouds-darkened-unpacking-the-aws-us-east-1-outage/"><link rel="alternate" type="application/atom+xml" href="https://blog.thefourcraft.com/feed.xml"><link rel="alternate" type="application/json" href="https://blog.thefourcraft.com/feed.json"><meta property="og:title" content="When the Clouds Darkened - Unpacking the AWS US-East-1 Outage"><meta property="og:image" content="https://blog.thefourcraft.com/media/posts/56/When-the-Clouds-Darkened-Unpacking-the-AWS-US-East-1-Outage.png"><meta property="og:image:width" content="1920"><meta property="og:image:height" content="1080"><meta property="og:site_name" content="DF Blogs"><meta property="og:description" content="AWS, one of the world's most extensive cloud service providers, faced a substantial outage in its US-East-1 region on December 7, 2021"><meta property="og:url" content="https://blog.thefourcraft.com/when-the-clouds-darkened-unpacking-the-aws-us-east-1-outage/"><meta property="og:type" content="article"><meta property="fb:app_id" content="1574887919592240"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@thefourcraft"><meta name="twitter:title" content="When the Clouds Darkened - Unpacking the AWS US-East-1 Outage"><meta name="twitter:description" content="AWS, one of the world's most extensive cloud service providers, faced a substantial outage in its US-East-1 region on December 7, 2021"><meta name="twitter:image" content="https://blog.thefourcraft.com/media/posts/56/When-the-Clouds-Darkened-Unpacking-the-AWS-US-East-1-Outage.png"><link rel="shortcut icon" href="https://blog.thefourcraft.com/media/website/logo.png" type="image/png"><link rel="preload" href="https://blog.thefourcraft.com/assets/dynamic/fonts/publicsans/publicsans.woff2" as="font" type="font/woff2" crossorigin><link rel="preload" href="https://blog.thefourcraft.com/assets/dynamic/fonts/oswald/oswald.woff2" as="font" type="font/woff2" crossorigin><link rel="stylesheet" href="https://blog.thefourcraft.com/assets/css/fontawesome-all.min.css?v=bbcde81f26378440dac4c3d195714389"><link rel="stylesheet" href="https://blog.thefourcraft.com/assets/css/style.css?v=355098d11bac9eeef8faecd493fe1e50"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.thefourcraft.com/when-the-clouds-darkened-unpacking-the-aws-us-east-1-outage/index.html"},"headline":"When the Clouds Darkened - Unpacking the AWS US-East-1 Outage","datePublished":"2023-07-05T15:44","dateModified":"2023-07-08T13:26","image":{"@type":"ImageObject","url":"https://blog.thefourcraft.com/media/posts/56/When-the-Clouds-Darkened-Unpacking-the-AWS-US-East-1-Outage.png","height":1080,"width":1920},"description":"AWS, one of the world's most extensive cloud service providers, faced a substantial outage in its US-East-1 region on December 7, 2021","author":{"@type":"Person","name":"thefourCraft","url":"https://blog.thefourcraft.com/authors/david/"},"publisher":{"@type":"Organization","name":"thefourCraft"}}</script></head><body class="is-preload"><div id="wrapper"><div id="main"><div class="inner"><header id="header"><a class="logo" href="https://blog.thefourcraft.com/index.html"><strong>DF Blogs</strong></a><ul class="icons"><li><a href="https://twitter.com/thefourcraft" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li><li><a href="https://www.facebook.com/david2004furman" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a></li><li><a href="https://www.instagram.com/david_furman/" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li><li><a href="https://www.linkedin.com/in/david-furman/" class="icon brands fa-linkedin"><span class="label">LinkedIn</span></a></li><li><a href="https://github.com/thefourcraft" class="icon brands fa-github"><span class="label">[MISSING TRANSLATION]</span></a></li><li><a href="https://reddit.com/user/thefourcraft" class="icon brands fa-reddit"><span class="label">[MISSING TRANSLATION]</span></a></li></ul></header><article class="post"><header class="main post__header"><time datetime="2023-07-05T15:44" class="post__date">15:44:13 05/07/23</time><h1>When the Clouds Darkened - Unpacking the AWS US-East-1 Outage</h1></header><figure class="image main"><img src="https://blog.thefourcraft.com/media/posts/56/When-the-Clouds-Darkened-Unpacking-the-AWS-US-East-1-Outage.png" srcset="https://blog.thefourcraft.com/media/posts/56/responsive/When-the-Clouds-Darkened-Unpacking-the-AWS-US-East-1-Outage-xs.png 300w, https://blog.thefourcraft.com/media/posts/56/responsive/When-the-Clouds-Darkened-Unpacking-the-AWS-US-East-1-Outage-sm.png 480w, https://blog.thefourcraft.com/media/posts/56/responsive/When-the-Clouds-Darkened-Unpacking-the-AWS-US-East-1-Outage-md.png 768w, https://blog.thefourcraft.com/media/posts/56/responsive/When-the-Clouds-Darkened-Unpacking-the-AWS-US-East-1-Outage-lg.png 1024w, https://blog.thefourcraft.com/media/posts/56/responsive/When-the-Clouds-Darkened-Unpacking-the-AWS-US-East-1-Outage-xl.png 1360w, https://blog.thefourcraft.com/media/posts/56/responsive/When-the-Clouds-Darkened-Unpacking-the-AWS-US-East-1-Outage-xxl.png 1600w" sizes="(max-width: 1600px) 100vw, 1600px" loading="lazy" height="1080" width="1920" alt=""></figure><div class="post__inner post__entry"><p>On December 7, 2021, the digital world experienced a significant disruption. Amazon Web Services (AWS), one of the world's most extensive cloud service providers, faced a substantial outage in its US-East-1 region. The impact was far-reaching, affecting numerous online services and applications, from popular streaming platforms to everyday services.</p><div class="flex-1 overflow-hidden"><div class="react-scroll-to-bottom--css-jramy-79elbk h-full dark:bg-gray-800"><div class="react-scroll-to-bottom--css-jramy-1n7m0yu"><div class="flex flex-col text-sm dark:bg-gray-800"><div class="group w-full text-gray-800 dark:text-gray-100 border-b border-black/10 dark:border-gray-900/50 bg-gray-50 dark:bg-[#444654]"><div class="flex p-4 gap-4 text-base md:gap-6 md:max-w-2xl lg:max-w-[38rem] xl:max-w-3xl md:py-6 lg:px-0 m-auto"><div class="relative flex w-[calc(100%-50px)] flex-col gap-1 md:gap-3 lg:w-[calc(100%-115px)]"><div class="flex flex-grow flex-col gap-3"><div class="flex items-start overflow-x-auto whitespace-pre-wrap break-words flex-col gap-4"><div class="markdown prose w-full break-words dark:prose-invert dark"><h2>The Outage Begins</h2><p>The day they started like any other Tuesday. However, at approximately 10:30 AM Eastern Time, things began to go awry in Amazon's North Virginia region, known as "us-east-1". Over the next three minutes, several regional AWS services started experiencing issues. This wasn't a complete outage for all these services. Still, their functionality was significantly impaired, causing a ripple effect that disrupted the operations of many businesses and services relying on AWS.</p><p>The services affected included the Management console, Route 53, API Gateway, EventBridge, Amazon Connect, and EC2. The outage affected all availability zones in us-east-1 and disrupted a number of global services that are homed in this region. This included AWS Account root logins, Single Sign-On (SSO), and the Security Token Service (STS).</p><h2>Event TimelineÂ </h2><ul><li><p><strong>7:30 AM PST</strong>: An automated activity to scale capacity of one of the AWS services triggered an unexpected behavior, resulting in a significant surge of connection activity that overwhelmed the networking devices between the internal network and the leading AWS network. This caused delays in communication between these networks, leading to increased latency and errors.</p></li><li><p><strong>9:28 AM PST</strong>: AWS teams completed work on moving the internal DNS traffic away from the congested network paths, which resulted in the complete recovery of DNS resolution errors. This improved the availability of several impacted services by reducing the load on the impacted networking devices but did not fully resolve the AWS service impact or eliminate the congestion.</p></li><li><p><strong>1:34 PM PST</strong>: Congestion significantly improved as the operations teams applied remediation actions.</p></li><li><p><strong>2:22 PM PST</strong>: All network devices fully recovered. However, full recovery for Amazon Secure Token Service (STS) occurred at 4:28 PM PST.</p></li><li><p><strong>4:37 PM PST</strong>: API Gateway largely recovered, but customers may have continued to experience low errors and throttling for several hours as API Gateways fully stabilized.</p></li><li><p><strong>5:00 PM PST</strong>: Fargate API error rates began returning to normal.</p></li><li><p><strong>6:40 PM PST</strong>: EventBridge experienced high event delivery latency until this time as it processed the backlog of events.</p></li></ul><h2>The Impact</h2><p>The impact of the outage was broad and far-reaching. It caused various problems for services like Netflix, Disney Plus, Roomba, Ticketmaster, and the Wall Street Journal. It also affected many Amazon services, including Prime Music, Ring doorbells, logistics apps in their fulfillment centers, and some parts of the Amazon.com shopping site.</p><p>The outage highlighted the interconnectedness of digital services and the potential domino effect that can occur when a primary cloud service provider experiences issues. It was a stark reminder of the potential risks of relying heavily on a single cloud service provider.</p><h2>The Root Cause</h2><p>After the dust settled, AWS provided a detailed explanation of what had caused the outage. The root cause was an unexpected behavior triggered by an automated system trying to scale up an internal service running on AWS's private internal network. This led to a significant surge of connection activity that overwhelmed the networking devices between the internal network and the leading AWS network, resulting in delays in communication between these networks.</p><p>These delays increased latency and errors for services communicating between these networks, leading to persistent congestion and performance issues on the devices connecting the two networks. This congestion immediately impacted the availability of real-time monitoring data for AWS's internal operations teams, which impaired their ability to find and resolve the source of congestion.</p><h2>The Aftermath and Lessons Learned</h2><p>The outage had a significant impact on AWS's reputation. However, it also provided valuable lessons for AWS and its users. AWS has since taken several actions to prevent a recurrence of this event. They have turned off the scaling activities that triggered the event and are working on fixing a latent issue that prevented their systems from adequately backing off during the event.</p><p>This incident serves as a reminder of the importance of designing robust and resilient systems. It also underscores the need for effective communication during operational issues. AWS has acknowledged the need to improve customer communication during such events and is planning significant upgrades.</p><h2>Looking Forward</h2><p>While the AWS outage was a significant event that caused widespread disruption, it also provided valuable lessons. It highlighted the importance of resilience in system design and the need for effective communication during operational issues. As AWS continues to learn from this event and improve its systems, users can also take this opportunity to evaluate their systems and consider how they can enhance their resilience to such events in the future.</p><p>In the world of cloud computing, outages are inevitable. However, they can be mitigated through robust system design, effective communication, and continuous learning from past incidents. The December 2021 AWS outage was a stark reminder of this reality. As we progress, cloud service providers and users must take these lessons to heart, continually striving to improve system resilience and response strategies.</p></div></div></div></div></div></div></div></div></div></div><div class="absolute bottom-0 left-0 w-full border-t md:border-t-0 dark:border-white/20 md:border-transparent md:dark:border-transparent md:bg-vert-light-gradient bg-white dark:bg-gray-800 md:!bg-transparent dark:md:bg-vert-dark-gradient pt-2 md:pl-2 md:w-[calc(100%-.5rem)]"><form class="stretch mx-2 flex flex-row gap-3 last:mb-2 md:mx-4 md:last:mb-6 lg:mx-auto lg:max-w-2xl xl:max-w-3xl"><div class="relative flex h-full flex-1 items-stretch md:flex-col" role="presentation"><div><div class="h-full flex ml-1 md:w-full md:m-auto md:mb-2 gap-0 md:gap-2 justify-center">Â </div></div></div></form></div></div><footer class="post__inner post__footer"><p class="post__last-updated">This article was updated on 13:26:17 08/07/23</p><div class="post__share"><h3>Share post:</h3><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fblog.thefourcraft.com%2Fwhen-the-clouds-darkened-unpacking-the-aws-us-east-1-outage%2Findex.html" class="js-share icon brands fa-facebook" rel="nofollow noopener noreferrer"><span class="label">Facebook</span> </a><a href="https://twitter.com/share?url=https%3A%2F%2Fblog.thefourcraft.com%2Fwhen-the-clouds-darkened-unpacking-the-aws-us-east-1-outage%2Findex.html&amp;via=thefourcraft&amp;text=When%20the%20Clouds%20Darkened%20-%20Unpacking%20the%20AWS%20US-East-1%20Outage" class="js-share icon brands fa-twitter" rel="nofollow noopener noreferrer"><span class="label">Twitter</span> </a><a href="https://pinterest.com/pin/create/button/?url=https%3A%2F%2Fblog.thefourcraft.com%2Fwhen-the-clouds-darkened-unpacking-the-aws-us-east-1-outage%2Findex.html&amp;media=https%3A%2F%2Fblog.thefourcraft.com%2Fmedia%2Fposts%2F56%2FWhen-the-Clouds-Darkened-Unpacking-the-AWS-US-East-1-Outage.png&amp;description=When%20the%20Clouds%20Darkened%20-%20Unpacking%20the%20AWS%20US-East-1%20Outage" class="js-share icon brands fa-pinterest" rel="nofollow noopener noreferrer"><span class="label">Pinterest</span> </a><a href="https://mix.com/add?url=https%3A%2F%2Fblog.thefourcraft.com%2Fwhen-the-clouds-darkened-unpacking-the-aws-us-east-1-outage%2Findex.html" class="js-share icon brands fa-mix" rel="nofollow noopener noreferrer"><span class="label">Mix</span> </a><a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fblog.thefourcraft.com%2Fwhen-the-clouds-darkened-unpacking-the-aws-us-east-1-outage%2Findex.html" class="js-share icon brands fa-linkedin" rel="nofollow noopener noreferrer"><span class="label">LinkedIn</span> </a><a href="https://buffer.com/add?text=When%20the%20Clouds%20Darkened%20-%20Unpacking%20the%20AWS%20US-East-1%20Outage&amp;url=https%3A%2F%2Fblog.thefourcraft.com%2Fwhen-the-clouds-darkened-unpacking-the-aws-us-east-1-outage%2Findex.html" class="js-share icon brands fa-buffer" rel="nofollow noopener noreferrer"><span class="label">Buffer</span> </a><a href="https://api.whatsapp.com/send?text=When%20the%20Clouds%20Darkened%20-%20Unpacking%20the%20AWS%20US-East-1%20Outage https%3A%2F%2Fblog.thefourcraft.com%2Fwhen-the-clouds-darkened-unpacking-the-aws-us-east-1-outage%2Findex.html" class="js-share icon brands fa-whatsapp" rel="nofollow noopener noreferrer"><span class="label">WhatsApp</span> </a><a href="https://news.ycombinator.com/submitlink?u=https%3A%2F%2Fblog.thefourcraft.com%2Fwhen-the-clouds-darkened-unpacking-the-aws-us-east-1-outage%2Findex.html&t=When%20the%20Clouds%20Darkened%20-%20Unpacking%20the%20AWS%20US-East-1%20Outage" class="js-share icon brands fa-hacker-news" rel="nofollow noopener noreferrer"><span class="label">[MISSING TRANSLATION]</span> </a><a href="https://medium.com/post?source=https%3A%2F%2Fblog.thefourcraft.com%2Fwhen-the-clouds-darkened-unpacking-the-aws-us-east-1-outage%2Findex.html&title=When%20the%20Clouds%20Darkened%20-%20Unpacking%20the%20AWS%20US-East-1%20Outage" class="js-share icon brands fa-medium" rel="nofollow noopener noreferrer"><span class="label">[MISSING TRANSLATION]</span> </a><a href="https://mastodon.social/share?text=When%20the%20Clouds%20Darkened%20-%20Unpacking%20the%20AWS%20US-East-1%20Outage&amp;url=https%3A%2F%2Fblog.thefourcraft.com%2Fwhen-the-clouds-darkened-unpacking-the-aws-us-east-1-outage%2Findex.html" class="js-share icon brands fa-mastodon" rel="nofollow noopener noreferrer"><span class="label">[MISSING TRANSLATION]</span> </a><a href="https://vk.com/share.php?url=https%3A%2F%2Fblog.thefourcraft.com%2Fwhen-the-clouds-darkened-unpacking-the-aws-us-east-1-outage%2Findex.html&amp;title=When%20the%20Clouds%20Darkened%20-%20Unpacking%20the%20AWS%20US-East-1%20Outage" class="js-share icon brands fa-vk" rel="nofollow noopener noreferrer"><span class="label">[MISSING TRANSLATION]</span> </a><a href="https://www.reddit.com/submit?url=https%3A%2F%2Fblog.thefourcraft.com%2Fwhen-the-clouds-darkened-unpacking-the-aws-us-east-1-outage%2Findex.html&amp;title=When%20the%20Clouds%20Darkened%20-%20Unpacking%20the%20AWS%20US-East-1%20Outage" class="js-share icon brands fa-reddit" rel="nofollow noopener noreferrer"><span class="label">[MISSING TRANSLATION]</span> </a><a href="https://www.tumblr.com/widgets/share/tool?canonicalUrl=https%3A%2F%2Fblog.thefourcraft.com%2Fwhen-the-clouds-darkened-unpacking-the-aws-us-east-1-outage%2Findex.html&amp;title=When%20the%20Clouds%20Darkened%20-%20Unpacking%20the%20AWS%20US-East-1%20Outage" class="js-share icon brands fa-tumblr" rel="nofollow noopener noreferrer"><span class="label">[MISSING TRANSLATION]</span> </a><a href="https://www.xing.com/app/user?op=share;url=https%3A%2F%2Fblog.thefourcraft.com%2Fwhen-the-clouds-darkened-unpacking-the-aws-us-east-1-outage%2Findex.html" class="js-share icon brands fa-xing" rel="nofollow noopener noreferrer"><span class="label">[MISSING TRANSLATION]</span> </a><a href="mailto:?subject=When%20the%20Clouds%20Darkened%20-%20Unpacking%20the%20AWS%20US-East-1%20Outage&amp;body=https%3A%2F%2Fblog.thefourcraft.com%2Fwhen-the-clouds-darkened-unpacking-the-aws-us-east-1-outage%2Findex.html" class="js-share icon fa-envelope" rel="nofollow noopener noreferrer"><span class="label">[MISSING TRANSLATION]</span></a></div><div class="post__tag"><ul><li><strong>Tagged in:</strong></li><li><a href="https://blog.thefourcraft.com/tags/aws/index.html">AWS</a></li><li><a href="https://blog.thefourcraft.com/tags/devops/index.html">DevOps</a></li><li><a href="https://blog.thefourcraft.com/tags/documentary/index.html">Documentary</a></li></ul></div><div class="post__bio"><img src="https://www.gravatar.com/avatar/a032a3cff682f8cfff78d0a88a1f9336?s&#x3D;240" loading="lazy" height="240" width="240" alt="thefourCraft"><div><h3><a href="https://blog.thefourcraft.com/authors/david/index.html" class="invert" rel="author">thefourCraft</a></h3><p>Hi, It&#x27;s me David... Online I go By the name thefourCraft to protect my identify</p></div></div></footer></article></div></div><div id="sidebar"><div class="inner"><div id="search" class="alt"></div><nav id="menu"><header class="major"><h2>Menu</h2></header><ul><li><a href="https://blog.thefourcraft.com/index.html" target="_self">Home</a></li><li><a href="https://www.linkedin.com/build-relation/newsletter-follow?entityUrn&#x3D;7062371340606930944" target="_blank">Subscribe on LinkedIn</a></li><li><a href="https://blog.thefourcraft.com/tags/index.html" target="_self">Topics</a></li><li><a href="https://www.thefourcraft.com" target="_self">Main Website</a></li><li><a href="https://www.thefourcraft.com/privacy-policy.html" target="_self">Privacy Policy</a></li></ul></nav><section><header class="major"><h2>Get in touch</h2></header><h1>Welcome To DF - Blogs</h1><p>I'm David, an 18-year-old self-taught DevOps and QA engineer passionate about technology and gaming. As a Webmaster <a href="https://aidock.net" target="_blank" rel="noopener">@AiDock</a>, I design, develop, and maintain the company's website while implementing the latest web technologies. I also volunteer with <a href="https://ims-network.org" target="_blank" rel="noopener">@ims-network</a> to build and sustain free game servers.</p><p><a class="libutton" href="https://www.linkedin.com/build-relation/newsletter-follow?entityUrn=7062371340606930944" target="_blank" rel="noopener">Subscribe on LinkedIn</a></p></section><footer id="footer"><p class="copyright">Â© DF. All rights are reserved under applicable copyright laws.<br>This site operates under an open-source license, specifically licensed by CC BY NC 4, which governs its usage and distribution.</p><p class="copyright">The site is powered by <a href="https://pages.cloudflare.com/" target="_blank" rel="noopener">Cloudflare Pages</a>, ensuring secure and reliable access.<br><br>It is important to note that all the tips or blogs provided on this website solely reflect my personal opinions and should not be construed as professional recommendations.<br>Â </p></footer></div></div></div><script src="https://blog.thefourcraft.com/assets/js/jquery.min.js?v=7c14a783dfeb3d238ccd3edd840d82ee"></script><script src="https://blog.thefourcraft.com/assets/js/browser.min.js?v=c07298dd19048a8a69ad97e754dfe8d0"></script><script src="https://blog.thefourcraft.com/assets/js/breakpoints.min.js?v=81a479eb099e3b187613943b085923b8"></script><script src="https://blog.thefourcraft.com/assets/js/util.min.js?v=cbdaf7c20ac2883c77ae23acfbabd47e"></script><script src="https://blog.thefourcraft.com/assets/js/main.min.js?v=08add7f6d435054ad38ec38d7cf8be40"></script><script>var images=document.querySelectorAll("img[loading]");for(var i=0;i<images.length;i++){if(images[i].complete){images[i].classList.add("is-loaded")}else{images[i].addEventListener("load",function(){this.classList.add("is-loaded")},false)}};</script><div class="pcb" data-behaviour="badge" data-behaviour-link="#cookie-settings" data-revision="1" data-config-ttl="30" data-debug-mode="false"><div role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="pcb-title" aria-describedby="pcb-txt" class="pcb__banner"><div class="pcb__inner"><div id="pcb-title" role="heading" aria-level="2" class="pcb__title">My Blogging Website Is Using Cookies</div><div id="pcb-txt" class="pcb__txt">Select which cookies to opt-in to via the checkboxes below; our website uses cookies to examine site traffic and user activity while on our site, for marketing, and to provide social media functionality. <a href="https://www.thefourcraft.com/privacy-policy.html">More details...</a></div><div class="pcb__buttons"><button type="button" class="pcb__btn pcb__btn--link pcb__btn--configure" aria-haspopup="dialog">Manage preferences</button> <button type="button" class="pcb__btn pcb__btn--reject">Reject</button> <button type="button" class="pcb__btn pcb__btn--solid pcb__btn--accept">Accept all</button></div></div></div><div class="pcb__popup" role="dialog" aria-modal="true" aria-hidden="true" aria-labelledby="pcb-popup-title"><div class="pcb__popup__wrapper"><div class="pcb__inner pcb__popup__inner"><div class="pcb__popup__heading"><div id="pcb-popup-title" role="heading" aria-level="2" class="pcb__title">Cookie settings</div><button class="pcb__popup__close" aria-label="Close"></button></div><div class="pcb__popup__content"><div class="pcb__txt pcb__popup__txt">I use cookies to enhance your browsing experience and security and analyze traffic. By clicking "Accept All", you consent to our use of cookies. <a href="https://www.thefourcraft.com/privacy-policy.html">More details...</a></div><ul class="pcb__groups"><li class="pcb__group"><details><summary class="pcb__group__title">Comments</summary><p class="pcb__group__txt">If You Want To Enable The 3rd Party Comments Integration</p></details><div class="pcb__popup__switch"><input type="checkbox" data-group-name="comments" id="comments-cookies"> <label for="comments-cookies">Comments</label></div></li><li class="pcb__group"><details><summary class="pcb__group__title">Functions</summary><p class="pcb__group__txt">If You Want Site 3rd Party Search</p></details><div class="pcb__popup__switch"><input type="checkbox" data-group-name="functions" id="functions-cookies"> <label for="functions-cookies">Functions</label></div></li><li class="pcb__group"><details><summary class="pcb__group__title">Analytics</summary><p class="pcb__group__txt">Enabling IMS - Analytics is subjected to IMS -Network's privacy policy https://legal.ims-network.net/privacy-policy.html</p></details><div class="pcb__popup__switch"><input type="checkbox" data-group-name="analytics" id="analytics-cookies"> <label for="analytics-cookies">Analytics</label></div></li><li class="pcb__group"><details><summary class="pcb__group__title">YouTube</summary><p class="pcb__group__txt">YouTubes & Google's Data Collection, because this website might have videos that are streamed with YouTube</p></details><div class="pcb__popup__switch"><input type="checkbox" data-group-name="youtube" id="youtube-cookies"> <label for="youtube-cookies">YouTube</label></div></li></ul></div><div class="pcb__buttons pcb__popup__buttons"><button type="button" class="pcb__btn pcb__btn--solid pcb__btn--accept">Accept all</button> <button type="button" class="pcb__btn pcb__btn--reject">Reject all</button> <button type="button" class="pcb__btn pcb__btn--save">Save settings</button></div></div></div></div><div class="pcb__overlay" aria-hidden="true"></div><button class="pcb__badge" aria-label="Cookie Policy" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" width="40" height="40" viewBox="0 0 23 23" fill="currentColor"><path d="M21.41 12.71c-.08-.01-.15 0-.22 0h-.03c-.03 0-.05 0-.08.01-.07 0-.13.01-.19.04-.52.21-1.44.19-2.02-.22-.44-.31-.65-.83-.62-1.53a.758.758 0 0 0-.27-.61.73.73 0 0 0-.65-.14c-1.98.51-3.49.23-4.26-.78-.82-1.08-.73-2.89.24-4.49.14-.23.14-.52 0-.75a.756.756 0 0 0-.67-.36c-.64.03-1.11-.1-1.31-.35-.19-.26-.13-.71-.01-1.29.04-.18.06-.38.03-.59-.05-.4-.4-.7-.81-.66C5.1 1.54 1 6.04 1 11.48 1 17.28 5.75 22 11.6 22c5.02 0 9.39-3.54 10.39-8.42.08-.4-.18-.78-.58-.87Zm-9.81 7.82c-5.03 0-9.12-4.06-9.12-9.06 0-4.34 3.05-8 7.25-8.86-.08.7.05 1.33.42 1.81.24.32.66.67 1.38.84-.76 1.86-.65 3.78.36 5.11.61.81 2.03 2 4.95 1.51.18.96.71 1.54 1.18 1.87.62.43 1.38.62 2.1.62.05 0 .09 0 .13-.01-1.23 3.64-4.7 6.18-8.64 6.18ZM13 17c0 .55-.45 1-1 1s-1-.45-1-1 .45-1 1-1 1 .45 1 1Zm5.29-12.3a.99.99 0 0 1-.29-.71c0-.55.45-.99 1-.99a1 1 0 0 1 .71.3c.19.19.29.44.29.71 0 .55-.45.99-1 .99a1 1 0 0 1-.71-.3ZM9 13.5c0 .83-.67 1.5-1.5 1.5S6 14.33 6 13.5 6.67 12 7.5 12s1.5.67 1.5 1.5Zm3.25.81a.744.744 0 0 1-.06-1.05c.28-.32.75-.34 1.05-.06.31.28.33.75.05 1.06-.15.16-.35.25-.56.25-.18 0-.36-.06-.5-.19ZM8.68 7.26c.41.37.44 1 .07 1.41-.2.22-.47.33-.75.33a.96.96 0 0 1-.67-.26c-.41-.37-.44-1-.07-1.41.37-.42 1-.45 1.41-.08Zm11.48 1.88c.18-.19.52-.19.7 0 .05.04.09.1.11.16.03.06.04.12.04.19 0 .13-.05.26-.15.35-.09.1-.22.15-.35.15s-.26-.05-.35-.15a.355.355 0 0 1-.11-.16.433.433 0 0 1-.04-.19c0-.13.05-.26.15-.35Zm-4.93-1.86a.75.75 0 1 1 1.059-1.06.75.75 0 0 1-1.059 1.06Z"/></svg></button></div><script>(function(win) {
    if (!document.querySelector('.pcb')) {
        return;
    }

    var cbConfig = {
        behaviour: document.querySelector('.pcb').getAttribute('data-behaviour'),
        behaviourLink: document.querySelector('.pcb').getAttribute('data-behaviour-link'),
        revision: document.querySelector('.pcb').getAttribute('data-revision'),
        configTTL: parseInt(document.querySelector('.pcb').getAttribute('data-config-ttl'), 10),
        debugMode: document.querySelector('.pcb').getAttribute('data-debug-mode') === 'true',
        initialState: null,
        previouslyAccepted: []
    };

    var cbUI = {
        wrapper: document.querySelector('.pcb'),
        banner: {
            element: null,
            btnAccept: null,
            btnReject: null,
            btnConfigure: null
        },
        popup: {
            element: null,
            btnClose: null,
            btnSave: null,
            btnAccept: null,
            btnReject: null,
            checkboxes: null,
        },
        overlay: null,
        badge: null,
        blockedScripts: document.querySelectorAll('script[type^="gdpr-blocker/"]'),
        triggerLinks: cbConfig.behaviourLink ? document.querySelectorAll('a[href*="' + cbConfig.behaviourLink + '"]') : null
    };

    function initUI () {
        // setup banner elements
        cbUI.banner.element = cbUI.wrapper.querySelector('.pcb__banner');
        cbUI.banner.btnAccept = cbUI.banner.element.querySelector('.pcb__btn--accept');
        cbUI.banner.btnReject = cbUI.banner.element.querySelector('.pcb__btn--reject');
        cbUI.banner.btnConfigure = cbUI.banner.element.querySelector('.pcb__btn--configure');

        // setup popup elements
        if (cbUI.wrapper.querySelector('.pcb__popup')) {
            cbUI.popup.element = cbUI.wrapper.querySelector('.pcb__popup');
            cbUI.popup.btnClose = cbUI.wrapper.querySelector('.pcb__popup__close');
            cbUI.popup.btnSave = cbUI.popup.element.querySelector('.pcb__btn--save');
            cbUI.popup.btnAccept = cbUI.popup.element.querySelector('.pcb__btn--accept');
            cbUI.popup.btnReject = cbUI.popup.element.querySelector('.pcb__btn--reject');
            cbUI.popup.checkboxes = cbUI.popup.element.querySelector('input[type="checkbox"]');
            // setup overlay
            cbUI.overlay = cbUI.wrapper.querySelector('.pcb__overlay');
        }

        cbUI.badge = cbUI.wrapper.querySelector('.pcb__badge');

        if (cbConfig.behaviour.indexOf('link') > -1) {
            for (var i = 0; i < cbUI.triggerLinks.length; i++) {
                cbUI.triggerLinks[i].addEventListener('click', function(e) {
                    e.preventDefault();
                    showBannerOrPopup();
                });
            }
        }
    }

    function initState () {
        var lsKeyName = getConfigName();
        var currentConfig = localStorage.getItem(lsKeyName);
        var configIsFresh = checkIfConfigIsFresh();

        if (!configIsFresh || currentConfig === null) {
            if (cbConfig.debugMode) {
                console.log('ðª Config not found, or configuration expired');
            }

            showBanner();
        } else if (typeof currentConfig === 'string') {
            if (cbConfig.debugMode) {
                console.log('ðª Config founded');
            }

            showBadge();

            if (cbUI.popup.element) {
                var allowedGroups = currentConfig.split(',');
                var checkedCheckboxes = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');

                for (var j = 0; j < checkedCheckboxes.length; j++) {
                    var name = checkedCheckboxes[j].getAttribute('data-group-name');

                    if (name && name !== '-' && allowedGroups.indexOf(name) === -1) {
                        checkedCheckboxes[j].checked = false;
                    }
                }

                for (var i = 0; i < allowedGroups.length; i++) {
                    var checkbox = cbUI.popup.element.querySelector('input[type="checkbox"][data-group-name="' + allowedGroups[i] + '"]');

                    if (checkbox) {
                        checkbox.checked = true;
                    }

                    allowCookieGroup(allowedGroups[i]);
                }
            }
        }

        setTimeout(function () {
            cbConfig.initialState = getInitialStateOfConsents();
        }, 0);
    }

    function checkIfConfigIsFresh () {
        var lastConfigSave = localStorage.getItem('publii-gdpr-cookies-config-save-date');

        if (lastConfigSave === null) {
            return false;
        }

        lastConfigSave = parseInt(lastConfigSave, 10);

        if (lastConfigSave === 0) {
            return true;
        }

        if (+new Date() - lastConfigSave < cbConfig.configTTL * 24 * 60 * 60 * 1000) {
            return true;
        }

        return false;
    }

    function initBannerEvents () {
        cbUI.banner.btnAccept.addEventListener('click', function (e) {
            e.preventDefault();
            acceptAllCookies('banner');
            showBadge();
        }, false);

        if (cbUI.banner.btnReject) {
            cbUI.banner.btnReject.addEventListener('click', function (e) {
                e.preventDefault();
                rejectAllCookies();
                showBadge();
            }, false);
        }

        if (cbUI.banner.btnConfigure) {
            cbUI.banner.btnConfigure.addEventListener('click', function (e) {
                e.preventDefault();
                hideBanner();
                showAdvancedPopup();
                showBadge();
            }, false);
        }
    }

    function initPopupEvents () {
        if (!cbUI.popup.element) {
            return;
        }

        cbUI.overlay.addEventListener('click', function (e) {
            hideAdvancedPopup();
        }, false);

        cbUI.popup.element.addEventListener('click', function (e) {
            e.stopPropagation();
        }, false);

        cbUI.popup.btnAccept.addEventListener('click', function (e) {
            e.preventDefault();
            acceptAllCookies('popup');
        }, false);

        cbUI.popup.btnReject.addEventListener('click', function (e) {
            e.preventDefault();
            rejectAllCookies();
        }, false);

        cbUI.popup.btnSave.addEventListener('click', function (e) {
            e.preventDefault();
            saveConfiguration();
        }, false);

        cbUI.popup.btnClose.addEventListener('click', function (e) {
            e.preventDefault();
            hideAdvancedPopup();
        }, false);
    }

    function initBadgeEvents () {
        if (!cbUI.badge) {
            return;
        }

        cbUI.badge.addEventListener('click', function (e) {
            showBannerOrPopup();
        }, false);
    }

    initUI();
    initState();
    initBannerEvents();
    initPopupEvents();
    initBadgeEvents();

    /**
     * API
     */
    function addScript (src, inline) {
        var newScript = document.createElement('script');

        if (src) {
            newScript.setAttribute('src', src);
        }

        if (inline) {
            newScript.text = inline;
        }

        document.body.appendChild(newScript);
    }

    function allowCookieGroup (allowedGroup) {
        var scripts = document.querySelectorAll('script[type="gdpr-blocker/' + allowedGroup + '"]');
        cbConfig.previouslyAccepted.push(allowedGroup);
    
        for (var j = 0; j < scripts.length; j++) {
            addScript(scripts[j].src, scripts[j].text);
        }

        var groupEvent = new Event('publii-cookie-banner-unblock-' + allowedGroup);
        document.body.dispatchEvent(groupEvent);
        unlockEmbeds(allowedGroup);

        if (cbConfig.debugMode) {
            console.log('ðª Allowed group: ' + allowedGroup);
        }
    }

    function showBannerOrPopup () {
        if (cbUI.popup.element) {
            showAdvancedPopup();
        } else {
            showBanner();
        }
    }

    function showAdvancedPopup () {
        cbUI.popup.element.classList.add('is-visible');
        cbUI.overlay.classList.add('is-visible');
        cbUI.popup.element.setAttribute('aria-hidden', 'false');
        cbUI.overlay.setAttribute('aria-hidden', 'false');
    }

    function hideAdvancedPopup () {
        cbUI.popup.element.classList.remove('is-visible');
        cbUI.overlay.classList.remove('is-visible');
        cbUI.popup.element.setAttribute('aria-hidden', 'true');
        cbUI.overlay.setAttribute('aria-hidden', 'true');
    }

    function showBanner () {
        cbUI.banner.element.classList.add('is-visible');
        cbUI.banner.element.setAttribute('aria-hidden', 'false');
    }

    function hideBanner () {
        cbUI.banner.element.classList.remove('is-visible');
        cbUI.banner.element.setAttribute('aria-hidden', 'true');
    }

    function showBadge () {
        if (!cbUI.badge) {
            return;
        }

        cbUI.badge.classList.add('is-visible');
        cbUI.badge.setAttribute('aria-hidden', 'false');
    }

    function getConfigName () {
        var lsKeyName = 'publii-gdpr-allowed-cookies';

        if (cbConfig.revision) {
            lsKeyName = lsKeyName + '-v' + parseInt(cbConfig.revision, 10);
        }

        return lsKeyName;
    }

    function storeConfiguration (allowedGroups) {
        var lsKeyName = getConfigName();
        var dataToStore = allowedGroups.join(',');
        localStorage.setItem(lsKeyName, dataToStore);

        if (cbConfig.configTTL === 0) {
            localStorage.setItem('publii-gdpr-cookies-config-save-date', 0);

            if (cbConfig.debugMode) {
                console.log('ðª Store never expiring configuration');
            }
        } else {
            localStorage.setItem('publii-gdpr-cookies-config-save-date', +new Date());
        }
    }

    function getInitialStateOfConsents () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        if (cbConfig.debugMode) {
            console.log('ðª Initial state: ' + groups.join(', '));
        }

        return groups;
    }

    function getCurrentStateOfConsents () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]:checked');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        if (cbConfig.debugMode) {
            console.log('ðª State to save: ' + groups.join(', '));
        }

        return groups;
    }

    function getAllGroups () {
        if (!cbUI.popup.element) {
            return [];
        }

        var checkedGroups = cbUI.popup.element.querySelectorAll('input[type="checkbox"]');
        var groups = [];

        for (var i = 0; i < checkedGroups.length; i++) {
            var allowedGroup = checkedGroups[i].getAttribute('data-group-name');

            if (allowedGroup !== '') {
                groups.push(allowedGroup);
            }
        }

        return groups;
    }

    function acceptAllCookies (source) {
        var groupsToAccept = getAllGroups();
        storeConfiguration(groupsToAccept);

        for (var i = 0; i < groupsToAccept.length; i++) {
            var group = groupsToAccept[i];

            if (cbConfig.initialState.indexOf(group) > -1 || cbConfig.previouslyAccepted.indexOf(group) > -1) {
                if (cbConfig.debugMode) {
                    console.log('ðª Skip previously activated group: ' + group);
                }

                continue;
            }

            allowCookieGroup(group);
        }

        if (cbUI.popup.element) {
            var checkboxesToCheck = cbUI.popup.element.querySelectorAll('input[type="checkbox"]');

            for (var j = 0; j < checkboxesToCheck.length; j++) {
                checkboxesToCheck[j].checked = true;
            }
        }

        if (cbConfig.debugMode) {
            console.log('ðª Accept all cookies: ', groupsToAccept.join(', '));
        }

        if (source === 'popup') {
            hideAdvancedPopup();
        } else if (source === 'banner') {
            hideBanner();
        }
    }

    function rejectAllCookies () {
        if (cbConfig.debugMode) {
            console.log('ðª Reject all cookies');
        }

        storeConfiguration([]);
        setTimeout(function () {
            window.location.reload();
        }, 100);
    }

    function saveConfiguration () {
        var groupsToAccept = getCurrentStateOfConsents();
        storeConfiguration(groupsToAccept);

        if (cbConfig.debugMode) {
            console.log('ðª Save new config: ', groupsToAccept.join(', '));
        }

        if (reloadIsNeeded(groupsToAccept)) {
            setTimeout(function () {
                window.location.reload();
            }, 100);
            return;
        }

        for (var i = 0; i < groupsToAccept.length; i++) {
            var group = groupsToAccept[i];

            if (cbConfig.initialState.indexOf(group) > -1 || cbConfig.previouslyAccepted.indexOf(group) > -1) {
                if (cbConfig.debugMode) {
                    console.log('ðª Skip previously activated group: ' + group);
                }

                continue;
            }

            allowCookieGroup(group);
        }

        hideAdvancedPopup();
    }

    function reloadIsNeeded (groupsToAccept) {
        // check if user rejected consent for initial groups
        var initialGroups = cbConfig.initialState;
        var previouslyAcceptedGroups = cbConfig.previouslyAccepted;
        var groupsToCheck = initialGroups.concat(previouslyAcceptedGroups);

        for (var i = 0; i < groupsToCheck.length; i++) {
            var groupToCheck = groupsToCheck[i];

            if (groupsToAccept.indexOf(groupToCheck) === -1) {
                if (cbConfig.debugMode) {
                    console.log('ðª Reload is needed due lack of: ', groupToCheck);
                }

                return true;
            }
        }

        return false;
    }

    function unlockEmbeds (cookieGroup) {
        var iframesToUnlock = document.querySelectorAll('.pec-wrapper[data-consent-group-id="' + cookieGroup + '"]');

        for (var i = 0; i < iframesToUnlock.length; i++) {
            var iframeWrapper = iframesToUnlock[i];
            iframeWrapper.querySelector('.pec-overlay').classList.remove('is-active');
            iframeWrapper.querySelector('.pec-overlay').setAttribute('aria-hidden', 'true');
            var iframe = iframeWrapper.querySelector('iframe');
            iframe.setAttribute('src', iframe.getAttribute('data-consent-src'));
        }
    }

    win.publiiEmbedConsentGiven = function (cookieGroup) {
        // it will unlock embeds
        allowCookieGroup(cookieGroup);

        var checkbox = cbUI.popup.element.querySelector('input[type="checkbox"][data-group-name="' + cookieGroup + '"]');

        if (checkbox) {
            checkbox.checked = true;
        }

        var groupsToAccept = getCurrentStateOfConsents();
        storeConfiguration(groupsToAccept);

        if (cbConfig.debugMode) {
            console.log('ðª Save new config: ', groupsToAccept.join(', '));
        }
    }
})(window);</script></body></html>